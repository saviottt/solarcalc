<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerala Smart Solar Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-50 text-gray-900 font-sans">

    <div class="max-w-6xl mx-auto px-4 py-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-orange-600 mb-2">Kerala Smart Solar Intelligence</h1>
            <p class="text-gray-600">Advanced AI-driven Solar Potential & Financial Projection</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Location & System Info</h2>
                <form id="solarForm" class="space-y-4">

                    <input type="hidden" name="Tariff" value="6.5">
                    <input type="hidden" name="Export_Tariff" value="3.5">

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium">Latitude</label>
                            <input type="number" step="any" name="Latitude" value="10.8505" required
                                class="w-full p-2 border rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">Longitude</label>
                            <input type="number" step="any" name="Longitude" value="76.2711" required
                                class="w-full p-2 border rounded-md">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 p-3 bg-orange-50 rounded-lg border border-orange-100">
                        <div>
                            <label class="block text-sm font-bold text-orange-800">Tilt Angle (°)</label>
                            <input type="number" step="0.1" name="Tilt" placeholder="Auto"
                                class="w-full p-2 border rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-orange-800">Azimuth (°)</label>
                            <input type="number" step="0.1" name="Azimuth" value="180"
                                class="w-full p-2 border rounded-md">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium">System Size (kW)</label>
                        <input type="number" step="0.1" name="System_Size" value="5" required
                            class="w-full p-2 border rounded-md">
                    </div>

                    <div>
                        <label class="block text-sm font-medium">Monthly Usage (kWh)</label>
                        <input type="number" name="Monthly_Consumption" value="300" required
                            class="w-full p-2 border rounded-md">
                    </div>

                    <div class="bg-blue-50 p-3 rounded-lg">
                        <h3 class="text-sm font-bold text-blue-800 mb-2">EV Parameters</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-medium">Daily KM</label>
                                <input type="number" name="EV_Daily_KM" value="40" class="w-full p-2 border rounded-md">
                            </div>
                            <div>
                                <label class="text-xs font-medium">Efficiency</label>
                                <input type="number" step="0.1" name="EV_Efficiency" value="7.0"
                                    class="w-full p-2 border rounded-md">
                            </div>
                        </div>
                    </div>

                    <button type="submit"
                        class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-lg transition duration-200">
                        Calculate
                    </button>
                </form>
            </section>

            <section class="lg:col-span-2 space-y-6">
                <div id="summaryCards" class="grid grid-cols-2 md:grid-cols-4 gap-4 hidden">
                    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
                        <p class="text-xs text-gray-500 uppercase">Yearly Gen</p>
                        <p id="resGen" class="text-xl font-bold">-- kWh</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                        <p class="text-xs text-gray-500 uppercase">Annual Benefit</p>
                        <p id="resBenefit" class="text-xl font-bold">₹ --</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-orange-500">
                        <p class="text-xs text-gray-500 uppercase">Payback</p>
                        <p id="resPayback" class="text-xl font-bold">-- Yrs</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow border-l-4 border-indigo-500">
                        <p class="text-xs text-gray-500 uppercase">CO2 Offset</p>
                        <p id="resCO2" class="text-xl font-bold">-- Tons</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-lg font-semibold mb-4">Monthly Generation</h3>
                    <canvas id="generationChart" height="100"></canvas>
                </div>

                <div id="outlookCard"
                    class="bg-gradient-to-r from-orange-500 to-orange-600 p-6 rounded-xl shadow-md text-white hidden">
                    <h3 class="text-lg font-bold mb-2">25-Year Outlook</h3>
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Total Savings</p>
                            <p id="resTotalSavings" class="text-3xl font-bold">₹ --</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm opacity-90">Net Profit</p>
                            <p id="resNetProfit" class="text-3xl font-bold">₹ --</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        const form = document.getElementById('solarForm');
        let chartInstance = null;

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(form));

            const payload = {
                Latitude: parseFloat(data.Latitude),
                Longitude: parseFloat(data.Longitude),
                Month: 1,
                System_Size: parseFloat(data.System_Size),
                Tariff: parseFloat(data.Tariff),
                Monthly_Consumption: parseFloat(data.Monthly_Consumption),
                EV_Daily_KM: parseFloat(data.EV_Daily_KM),
                EV_Efficiency: parseFloat(data.EV_Efficiency),
                Export_Tariff: parseFloat(data.Export_Tariff),
                Tilt: data.Tilt ? parseFloat(data.Tilt) : null,
                Azimuth: parseFloat(data.Azimuth)
            };

            try {
                const response = await fetch('http://localhost:8000/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                updateUI(result);
            } catch (err) {
                alert("Error: Ensure your app.py server is running.");
            }
        });

        function updateUI(res) {
            document.getElementById('summaryCards').classList.remove('hidden');
            document.getElementById('outlookCard').classList.remove('hidden');

            document.getElementById('resGen').innerText = res.Solar_Generation_kWh_per_Year.toLocaleString() + " kWh";
            document.getElementById('resBenefit').innerText = "₹ " + res.Annual_Net_Benefit_Rs.toLocaleString();
            document.getElementById('resPayback').innerText = res.Payback_Years + " Yrs";
            document.getElementById('resCO2').innerText = res.CO2_Offset_Tons_per_Year + " Tons";
            document.getElementById('resTotalSavings').innerText = "₹ " + res["25_Year_Total_Savings_Rs"].toLocaleString();
            document.getElementById('resNetProfit').innerText = "₹ " + res["25_Year_Net_Profit_Rs"].toLocaleString();

            renderChart(res.Monthly_Breakdown);
        }

        function renderChart(monthlyData) {
            const ctx = document.getElementById('generationChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthlyData.map(m => m.Month),
                    datasets: [{
                        label: 'Generation (kWh)',
                        data: monthlyData.map(m => m.Monthly_Energy_kWh),
                        backgroundColor: 'rgba(249, 115, 22, 0.7)'
                    }]
                }
            });
        }
    </script>
</body>

</html>